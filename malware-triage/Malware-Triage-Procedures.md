# Malware Triage & Analysis Procedures

**Version:** 1.4  
**Last Updated:** 2026-02-19  
**Classification:** Internal Use

---

## Malware Triage Overview

Malware triage is the initial analysis phase that determines threat level and required response actions.

---

## Triage Workflow

### Step 1: File Identification

```
Received Suspicious File: download.exe

Analysis:
├─ Filename: download.exe
├─ File size: 128 KB
├─ File type: Portable Executable (PE)
├─ MD5: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
├─ SHA256: [256-bit hash]
└─ Magic bytes: 4D 5A (PE header signature)

Initial Assessment:
├─ Executable file (suspicious, not document)
├─ Size reasonable for malware (128 KB typical)
├─ Not signed digitally (red flag)
└─ Verdict: Likely malware, proceed with triage
```

### Step 2: Static Analysis

```
Static Analysis (without executing):

1. VirusTotal Scan:
   └─ Upload to virustotal.com
      ├─ Result: 45/70 engines detect as malware
      ├─ Verdict: Emotet banking trojan
      ├─ First seen: 2026-02-15
      └─ Threat level: CRITICAL

2. Strings Analysis:
   └─ Extract ASCII/Unicode from binary
      ├─ Found: "C:\Windows\Temp\emotet.exe"
      ├─ Found: "10.0.0.1:8080" (C2 server)
      ├─ Found: "Accept-Language: en-US"
      └─ Threat level: Confirmed malware

3. PE Header Analysis:
   └─ Examine import tables
      ├─ Imports: kernel32.dll, ws2_32.dll, user32.dll
      ├─ Indicates: Process creation, network communication
      ├─ No unusual imports (no rootkit indicators)
      └─ Threat level: Moderate persistence expected

4. Digital Signature Check:
   └─ Verify code signing
      ├─ NOT signed (red flag)
      ├─ Legitimate software usually signed
      └─ Threat level: Increases likelihood of malware
```

### Step 3: Environmental Analysis

```
Where was malware found?

Location: C:\Users\john.smith\Downloads\download.exe
User:     john.smith (marketing department)
Time:     2026-02-19 14:30 UTC
Source:   Received via email from "supplier@company-lookalike.xyz"

Email Analysis:
├─ From: supplier@company-lookalike.xyz (SPOOFED!)
├─ Subject: "Updated Pricing Sheet 2026"
├─ Attachment: "pricing.exe" (disguised as document)
└─ Red flag: Company lookalike domain

Verdict:
├─ Spear phishing campaign (targeted)
├─ User compromised: john.smith's account
├─ System compromised: john.smith's workstation
├─ Risk: Likely executed malware already
└─ Action: Immediate isolation required
```

### Step 4: Dynamic Analysis (Safe Environment)

```
Safe Execution (Sandbox):

Tool: Cuckoo Sandbox

Sample: download.exe (a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6)

Execution Report:

Behaviors Observed:
├─ Process spawned: svchost.exe (suspicious parent)
├─ Network connection: 10.0.0.1:8080 (C2 beacon)
├─ Registry modification: HKLM\Software\...\Run (persistence)
├─ File creation: C:\Windows\Temp\emotet.dll
├─ Mutant object: "Global\Emotet_Payload" (malware fingerprint)
└─ Behavioral verdict: CONFIRMED EMOTET BANKING TROJAN

Network Activity:
├─ DNS query: "C2-server-emotet.xyz" → 10.0.0.1
├─ Connection: POST http://10.0.0.1:8080/check (C2 check-in)
├─ Data: System info (OS version, IP address)
└─ C2 Verdict: Active command & control connection

File System Activity:
├─ Drop: C:\Windows\Temp\emotet.dll
├─ Drop: C:\Windows\Temp\service.exe (second stage)
├─ Registry: HKCU\Software\...\Run\"Windows Update" = C:\Windows\Temp\service.exe
└─ Persistence: Confirmed (multiple mechanisms)
```

### Step 5: Threat Assessment

```
Threat Level: CRITICAL

Reasoning:
├─ Malware type: Banking trojan (steals credentials, money)
├─ Persistence: 3 mechanisms (service, registry, DLL injection)
├─ C2 active: Confirmed beacon to remote server
├─ Propagation: Can spread to file shares and USB
├─ Data theft: Can harvest banking credentials
├─ Impact: Could compromise entire network
└─ Recommended action: Immediate system isolation & rebuild

Triage Summary:
┌─ Detection: Phishing email with malware attachment
├─ Classification: Banking trojan (Emotet family)
├─ Severity: CRITICAL
├─ Containment: Isolate user system immediately
├─ Eradication: Rebuild system from clean backup
├─ Validation: Scan for related infections
└─ Timeline: Complete within 4 hours
```

---

## IOC Extraction

```
Extracted Indicators of Compromise (IOCs):

1. File Hashes:
   ├─ MD5: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
   ├─ SHA256: [256-bit hash]
   └─ Action: Add to malware signatures, alert if found elsewhere

2. Network IOCs:
   ├─ C2 Server: 10.0.0.1 (port 8080)
   ├─ Domain: C2-server-emotet.xyz
   └─ Action: Block at firewall, DNS sinkhole

3. Process IOCs:
   ├─ Executable names: emotet.exe, emotet.dll, service.exe
   ├─ Parent process: svchost.exe (unusual)
   └─ Action: Alert if observed in SIEM

4. Registry IOCs:
   ├─ Run key: HKCU\Software\...\Run\"Windows Update"
   ├─ Value: C:\Windows\Temp\service.exe
   └─ Action: Alert on creation of similar registry keys

5. Behavioral IOCs:
   ├─ DLL Injection: Into legitimate processes
   ├─ Persistence: Service + registry + DLL
   ├─ C2 Communication: HTTPS on non-standard port
   └─ Action: Alert on these behaviors in EDR

Distribute IOCs:
├─ Antivirus team: File hashes for signature update
├─ Network team: Block C2 domains and IPs
├─ SIEM team: Create detection rules
├─ EDR team: Update malware signatures
└─ Threat intel team: Share with industry
```

---

## Triage Time Allocation

```
Total Triage Time: 30-60 minutes per sample

Breakdown:
├─ File receipt & identification: 5 minutes
├─ VirusTotal scan: 2 minutes (automated)
├─ Static analysis (strings, PE): 10 minutes
├─ Dynamic analysis (sandbox): 15 minutes
├─ Report writing & IOC extraction: 10 minutes
└─ Escalation & distribution: 5 minutes

Triage Level Determination:

LOW-PRIORITY TRIAGE (10 minutes):
├─ Indicator: VirusTotal detects as known malware
├─ Analysis: Run VirusTotal + strings analysis
├─ Decision: If known malware, assign to alert system
└─ Escalation: Low (automated response)

MEDIUM-PRIORITY TRIAGE (30 minutes):
├─ Indicator: Unknown malware, limited detections
├─ Analysis: Full static + sandbox analysis
├─ Decision: Assess threat and containment actions
└─ Escalation: Medium (IR team notified)

HIGH-PRIORITY TRIAGE (60 minutes):
├─ Indicator: Novel malware, 0/70 detection
├─ Analysis: Deep forensic analysis required
├─ Decision: Advanced techniques, manual review
└─ Escalation: CRITICAL (Immediate IR activation)
```

---

## Malware Family Indicators

```
Detecting Common Malware Families:

EMOTET (Banking Trojan):
├─ File size: 100-200 KB
├─ Exports: Usually embedded in Microsoft Office macro
├─ C2: HTTPS beaconing every 60 seconds
├─ Persistence: Service creation + Registry Run key
├─ Indicator: "emotet_c2_beacon" strings
└─ Response: Isolate, rebuild, block C2

TRICKBOT (Banking Trojan):
├─ File size: 50-150 KB
├─ Behavior: Process injection into svchost.exe
├─ C2: HTTP POST to C2 servers (frequent)
├─ Persistence: Registry Service key + DLL sideload
├─ Indicator: "user_computer" registry value
└─ Response: Same as Emotet

MIMIKATZ (Credential Dumper):
├─ File size: 1-3 MB (larger than most malware)
├─ Behavior: Reads LSASS process memory
├─ Extraction: Windows/AD credentials, Kerberos tickets
├─ Indicator: LSASS access (Event ID 10 - Sysmon)
├─ Indicator: "\\.\pipe\minik*" named pipe
└─ Response: Assume all domain credentials compromised

COBALT STRIKE (Post-Exploitation):
├─ File size: 50-200 KB (beacon)
├─ Behavior: Reverse shell, lateral movement
├─ C2: HTTPS with JA3 fingerprint match
├─ Persistence: Service, scheduled task, DLL
├─ Indicator: JA3 hash match + consistent beacon timing
└─ Response: Full incident response activation
```

---

## Common Triage Mistakes

```
❌ MISTAKE 1: Not isolating suspected infected system
└─ Result: Malware spreads to network
└─ Fix: Isolate BEFORE analysis

❌ MISTAKE 2: Double-clicking malware to "verify"
└─ Result: System immediately compromised
└─ Fix: Use static analysis first (strings, PE header)

❌ MISTAKE 3: Not checking VirusTotal first
└─ Result: Wasting time analyzing known malware
└─ Fix: VirusTotal should be first step (2 minutes)

❌ MISTAKE 4: Skipping persistence analysis
└─ Result: Rebuild system, malware returns on reboot
└─ Fix: Always check for persistence mechanisms

❌ MISTAKE 5: Not extracting IOCs
└─ Result: Same malware reappears, no detection
└─ Fix: Document all hashes, IPs, domains, strings

✓ BEST PRACTICE: Use safe sandbox (Cuckoo, Joe)
└─ Benefit: See malware behavior without risk
└─ Alternative: Submit to VirusTotal for analysis
```

---

## References

- Cuckoo Sandbox Documentation
- Malware Analysis Fundamentals (SANS)
- Wireshark Malware Analysis Guide

---

*Document Maintenance:*
- Update malware families quarterly
- Test sandbox environment monthly
- Review triage procedures annually
